<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>src.webcrawling.androidrank_crawler API documentation</title>
<meta name="description" content="This script contains functions to retrieve the top app IDs for a given category using web scraping with Selenium â€¦" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>src.webcrawling.androidrank_crawler</code></h1>
</header>
<section id="section-intro">
<p>This script contains functions to retrieve the top app IDs for a given category using web scraping with Selenium.</p>
<p>The script utilizes the Selenium WebDriver to navigate the AndroidRank website and extract app IDs based on the specified category and number of IDs to retrieve.</p>
<p>The main functions in this script are:
- get_ids_for_category: Retrieves the top app IDs for a given category.
- get_ids_on_page: Retrieves the app IDs on the current page.
- click_next_page: Clicks the "Next" button to navigate to the next page.</p>
<p>Note: This script requires the Selenium library and a running Selenium WebDriver server.</p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">&#34;&#34;&#34;
This script contains functions to retrieve the top app IDs for a given category using web scraping with Selenium.

The script utilizes the Selenium WebDriver to navigate the AndroidRank website and extract app IDs based on the specified category and number of IDs to retrieve.

The main functions in this script are:
- get_ids_for_category: Retrieves the top app IDs for a given category.
- get_ids_on_page: Retrieves the app IDs on the current page.
- click_next_page: Clicks the &#34;Next&#34; button to navigate to the next page.

Note: This script requires the Selenium library and a running Selenium WebDriver server.

&#34;&#34;&#34;

import re
import time
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

from src.models import CATEGORIES

categories = CATEGORIES


def get_ids_for_category(category, number):
    &#34;&#34;&#34;
    Get the top app IDs for a given category.

    Args:
        category (str): The category for which to retrieve app IDs.
        number (int): The number of app IDs to retrieve.

    Returns:
        list: The list of app IDs.

    Raises:
        Exception: If an error occurs while crawling the IDs.

    &#34;&#34;&#34;
    print(f&#39;Getting top {number} IDs for {category}&#39;)
    ids = []
    url = &#34;https://androidrank.org/android-most-popular-google-play-apps&#34;
    driver = None
    
    try:
        # Start driver and open androidrank
        chrome_options = webdriver.ChromeOptions()
        chrome_options.add_argument(&#39;--lang=en-US&#39;)  # Set browser language to English
        chrome_options.add_experimental_option(&#39;prefs&#39;, {&#39;profile.default_content_setting_values.cookies&#39;: 2})
        driver = webdriver.Remote(&#39;http://chrome:4444/wd/hub&#39;, options=chrome_options)
        driver.set_page_load_timeout(30)
        driver.get(f&#39;{url}{categories[category]}&#39;)

        # Get IDs from androidrank
        while len(ids) &lt; number:
            wait = WebDriverWait(driver, 10)
            wait.until(EC.visibility_of_element_located((By.TAG_NAME, &#39;tbody&#39;)))
            links = driver.find_element(By.TAG_NAME, &#39;tbody&#39;).find_elements(By.TAG_NAME, &#39;a&#39;)
            links = list(map(lambda x: x.get_attribute(&#34;href&#34;), links))
            # Match IDs of apps embedded in links and add to IDs
            regex = r&#39;^https://androidrank\.org/application/.+/([^/]+)$&#39;
            for l in links:
                match = re.search(regex, l)
                if match and len(ids) &lt; number:
                    ids.append(match.group(1))

            if len(ids) == number:
                break
            driver = click_next_page(driver)
            if driver is None:
                break
        
    except Exception as e:
        print(e)
        print(f&#39;Error while crawling top {number} from {category}&#39;)
        print(f&#39;Crawled {len(ids)} out of {number}&#39;)
        print(ids)

    finally:
        if driver is not None:
            driver.quit()
    
    print(f&#39;{len(ids)}/{number} IDs crawled: {ids}&#39;, &#39;\n&#39;)
    return ids


def get_ids_on_page(ids, driver, number):
    &#34;&#34;&#34;
    Get the app IDs on the current page.

    Args:
        ids (list): The existing list of app IDs.
        driver (webdriver): The WebDriver instance.
        number (int): The max number of app IDs to retrieve.

    Returns:
        list: The updated list of app IDs.

    Raises:
        Exception: If an error occurs while finding the IDs.

    &#34;&#34;&#34;
    # Get all &#39;a&#39; tags with links that hold app names from one page
    try:
        links = driver.find_element(By.TAG_NAME, &#39;tbody&#39;).find_elements(By.TAG_NAME, &#39;a&#39;)
        links = list(map(lambda x: x.get_attribute(&#34;href&#34;), links))
        # Match IDs of apps embedded in links and add to IDs
        regex = r&#39;^https://androidrank\.org/application/.+/([^/]+)$&#39;
        for l in links:
            match = re.search(regex, l)
            if match and len(ids) &lt; number:
                ids.append(match.group(1))
    except Exception as e:
        print(&#39;Error while finding IDs&#39;)
        print(f&#39;Current URL: {driver.current_url}&#39;)
        print(f&#39;Crawled {len(ids)} out of {number}&#39;)
        print(ids)
        if driver is not None:
            driver.quit()
        return ids

    return ids


def click_next_page(driver):
    &#34;&#34;&#34;
    Click the &#34;Next&#34; button to navigate to the next page.

    Args:
        driver (webdriver): The WebDriver instance.

    Returns:
        webdriver or None: The updated WebDriver instance if successful, None otherwise.

    Raises:
        Exception: If an error occurs while clicking the &#34;Next&#34; button.

    &#34;&#34;&#34;
    try:
        # Last page starts has &#39;start=481&#39; - no need to click next page
        if &#39;start=481&#39; not in driver.current_url:
            # &#34;First&#34; and &#34;Previous&#34; buttons are disabled on the first page resulting in a different XPATH
            if &#39;start=&#39; in driver.current_url:
                wait = WebDriverWait(driver, 10)  # Maximum wait time of 10 seconds
                wait.until(EC.element_to_be_clickable((By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[3]&#34;)))
                next_btn = driver.find_element(By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[3]&#34;)
            else:
                # Wait until the button becomes clickable
                wait = WebDriverWait(driver, 10)  # Maximum wait time of 10 seconds
                wait.until(EC.element_to_be_clickable((By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[1]&#34;)))
                next_btn = driver.find_element(By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[1]&#34;)
            
            # Get the href attribute value
            href = next_btn.get_attribute(&#39;href&#39;)

            # Open next page
            driver.get(href)
            time.sleep(1)

    except Exception as e:
        print(e)
        print(f&#39;Cannot click &#34;next&#34;&#39;)
        print(f&#39;Current URL: {driver.current_url}&#39;)
        print(f&#39;Trying to click: {href}&#39;)

        if driver is not None:
            driver.quit()
        return None
    return driver</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="src.webcrawling.androidrank_crawler.click_next_page"><code class="name flex">
<span>def <span class="ident">click_next_page</span></span>(<span>driver)</span>
</code></dt>
<dd>
<div class="desc"><p>Click the "Next" button to navigate to the next page.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>driver</code></strong> :&ensp;<code>webdriver</code></dt>
<dd>The WebDriver instance.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>webdriver</code> or <code>None</code></dt>
<dd>The updated WebDriver instance if successful, None otherwise.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>Exception</code></dt>
<dd>If an error occurs while clicking the "Next" button.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def click_next_page(driver):
    &#34;&#34;&#34;
    Click the &#34;Next&#34; button to navigate to the next page.

    Args:
        driver (webdriver): The WebDriver instance.

    Returns:
        webdriver or None: The updated WebDriver instance if successful, None otherwise.

    Raises:
        Exception: If an error occurs while clicking the &#34;Next&#34; button.

    &#34;&#34;&#34;
    try:
        # Last page starts has &#39;start=481&#39; - no need to click next page
        if &#39;start=481&#39; not in driver.current_url:
            # &#34;First&#34; and &#34;Previous&#34; buttons are disabled on the first page resulting in a different XPATH
            if &#39;start=&#39; in driver.current_url:
                wait = WebDriverWait(driver, 10)  # Maximum wait time of 10 seconds
                wait.until(EC.element_to_be_clickable((By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[3]&#34;)))
                next_btn = driver.find_element(By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[3]&#34;)
            else:
                # Wait until the button becomes clickable
                wait = WebDriverWait(driver, 10)  # Maximum wait time of 10 seconds
                wait.until(EC.element_to_be_clickable((By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[1]&#34;)))
                next_btn = driver.find_element(By.XPATH, &#34;/html/body/div[1]/div[2]/div[1]/small/a[1]&#34;)
            
            # Get the href attribute value
            href = next_btn.get_attribute(&#39;href&#39;)

            # Open next page
            driver.get(href)
            time.sleep(1)

    except Exception as e:
        print(e)
        print(f&#39;Cannot click &#34;next&#34;&#39;)
        print(f&#39;Current URL: {driver.current_url}&#39;)
        print(f&#39;Trying to click: {href}&#39;)

        if driver is not None:
            driver.quit()
        return None
    return driver</code></pre>
</details>
</dd>
<dt id="src.webcrawling.androidrank_crawler.get_ids_for_category"><code class="name flex">
<span>def <span class="ident">get_ids_for_category</span></span>(<span>category, number)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the top app IDs for a given category.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>category</code></strong> :&ensp;<code>str</code></dt>
<dd>The category for which to retrieve app IDs.</dd>
<dt><strong><code>number</code></strong> :&ensp;<code>int</code></dt>
<dd>The number of app IDs to retrieve.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list</code></dt>
<dd>The list of app IDs.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>Exception</code></dt>
<dd>If an error occurs while crawling the IDs.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_ids_for_category(category, number):
    &#34;&#34;&#34;
    Get the top app IDs for a given category.

    Args:
        category (str): The category for which to retrieve app IDs.
        number (int): The number of app IDs to retrieve.

    Returns:
        list: The list of app IDs.

    Raises:
        Exception: If an error occurs while crawling the IDs.

    &#34;&#34;&#34;
    print(f&#39;Getting top {number} IDs for {category}&#39;)
    ids = []
    url = &#34;https://androidrank.org/android-most-popular-google-play-apps&#34;
    driver = None
    
    try:
        # Start driver and open androidrank
        chrome_options = webdriver.ChromeOptions()
        chrome_options.add_argument(&#39;--lang=en-US&#39;)  # Set browser language to English
        chrome_options.add_experimental_option(&#39;prefs&#39;, {&#39;profile.default_content_setting_values.cookies&#39;: 2})
        driver = webdriver.Remote(&#39;http://chrome:4444/wd/hub&#39;, options=chrome_options)
        driver.set_page_load_timeout(30)
        driver.get(f&#39;{url}{categories[category]}&#39;)

        # Get IDs from androidrank
        while len(ids) &lt; number:
            wait = WebDriverWait(driver, 10)
            wait.until(EC.visibility_of_element_located((By.TAG_NAME, &#39;tbody&#39;)))
            links = driver.find_element(By.TAG_NAME, &#39;tbody&#39;).find_elements(By.TAG_NAME, &#39;a&#39;)
            links = list(map(lambda x: x.get_attribute(&#34;href&#34;), links))
            # Match IDs of apps embedded in links and add to IDs
            regex = r&#39;^https://androidrank\.org/application/.+/([^/]+)$&#39;
            for l in links:
                match = re.search(regex, l)
                if match and len(ids) &lt; number:
                    ids.append(match.group(1))

            if len(ids) == number:
                break
            driver = click_next_page(driver)
            if driver is None:
                break
        
    except Exception as e:
        print(e)
        print(f&#39;Error while crawling top {number} from {category}&#39;)
        print(f&#39;Crawled {len(ids)} out of {number}&#39;)
        print(ids)

    finally:
        if driver is not None:
            driver.quit()
    
    print(f&#39;{len(ids)}/{number} IDs crawled: {ids}&#39;, &#39;\n&#39;)
    return ids</code></pre>
</details>
</dd>
<dt id="src.webcrawling.androidrank_crawler.get_ids_on_page"><code class="name flex">
<span>def <span class="ident">get_ids_on_page</span></span>(<span>ids, driver, number)</span>
</code></dt>
<dd>
<div class="desc"><p>Get the app IDs on the current page.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>ids</code></strong> :&ensp;<code>list</code></dt>
<dd>The existing list of app IDs.</dd>
<dt><strong><code>driver</code></strong> :&ensp;<code>webdriver</code></dt>
<dd>The WebDriver instance.</dd>
<dt><strong><code>number</code></strong> :&ensp;<code>int</code></dt>
<dd>The max number of app IDs to retrieve.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>list</code></dt>
<dd>The updated list of app IDs.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>Exception</code></dt>
<dd>If an error occurs while finding the IDs.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_ids_on_page(ids, driver, number):
    &#34;&#34;&#34;
    Get the app IDs on the current page.

    Args:
        ids (list): The existing list of app IDs.
        driver (webdriver): The WebDriver instance.
        number (int): The max number of app IDs to retrieve.

    Returns:
        list: The updated list of app IDs.

    Raises:
        Exception: If an error occurs while finding the IDs.

    &#34;&#34;&#34;
    # Get all &#39;a&#39; tags with links that hold app names from one page
    try:
        links = driver.find_element(By.TAG_NAME, &#39;tbody&#39;).find_elements(By.TAG_NAME, &#39;a&#39;)
        links = list(map(lambda x: x.get_attribute(&#34;href&#34;), links))
        # Match IDs of apps embedded in links and add to IDs
        regex = r&#39;^https://androidrank\.org/application/.+/([^/]+)$&#39;
        for l in links:
            match = re.search(regex, l)
            if match and len(ids) &lt; number:
                ids.append(match.group(1))
    except Exception as e:
        print(&#39;Error while finding IDs&#39;)
        print(f&#39;Current URL: {driver.current_url}&#39;)
        print(f&#39;Crawled {len(ids)} out of {number}&#39;)
        print(ids)
        if driver is not None:
            driver.quit()
        return ids

    return ids</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="src.webcrawling" href="index.html">src.webcrawling</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="src.webcrawling.androidrank_crawler.click_next_page" href="#src.webcrawling.androidrank_crawler.click_next_page">click_next_page</a></code></li>
<li><code><a title="src.webcrawling.androidrank_crawler.get_ids_for_category" href="#src.webcrawling.androidrank_crawler.get_ids_for_category">get_ids_for_category</a></code></li>
<li><code><a title="src.webcrawling.androidrank_crawler.get_ids_on_page" href="#src.webcrawling.androidrank_crawler.get_ids_on_page">get_ids_on_page</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>